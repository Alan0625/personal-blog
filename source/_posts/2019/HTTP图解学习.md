---
title: HTTP图解学习
permalink: HTTP图解学习
comments: true
date: 2019-06-09 19:18:31
updated: 2019-06-09 19:18:31
tags: HTTP
categories: HTTP
---


# 第一章 了解Web及网路基础

## 1.1 使用HTTP协议访问Web

- 像这种通过发送请求获取服务器资源的web浏览器等，都可称为客户端。

- HTTP (HyperText Transfer Protocol) 超文本传输协议

- WWW的3项构建技术:
  - HTML(HyperText Markup Language) 超文本标记语言
  - HTTP(HyperText Transfer Protocol) 超文本传输协议
  - URL(Uniform Resource Locator) 统一资源定位符

## 1.2 HTTP的诞生
----
- 1996/5  HTTP/1.0  RFC1945
- 1997/1  HTTP/1.1  RFC2068 -> RFC2616， 目前主流的HTTP协议版本
- 2013/8  HTTP/2.0  正在制定中

## 1.3 网络基础TCP/IP

- 像这种把与互联网相关联的协议集合起来总称为TCP/IP.

- TCP/IP 分为四层：

  - 应用层： 决定了向用户提供应用服务时通信的活动。
  （FTP(File Transfer Protocol，文件传输协议 )、 HTTP(HyperText Transfer Protocol)  、DNS(Domain Name System，域名系统))
  - 传输层： 对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。
   (TCP(Transmission Control Protocol, 传输控制协议)， UDP(User Data Protocol, 用户数据报协议))
  - 网络层： 处理在网络上流动的数据包。数据包是网络传输的最小的数据单位。
    (IP（Internet Protocol）, 网际协议)
  - 数据链路层： 用来处理连接网络的硬件部分。包括操作系统，硬件的设备驱动，网卡，及光纤等。硬件上的范畴均在数据链路层的作用范围之内。

- TCP/IP 通信传输流

  - 利用TCP/IP协议族进行通信时，会通过分层顺序与对方进行通信，客户端从应用层往下走，服务端往应用层往上走。


## 1.4 与HTTP关系密切的协议： IP 、TCP 、DNS

- IP（Internet Protocol）, 网际协议,位于网络层， 作用是把各种数据包传送给对方。
  保证数据准确传送到对方那里，需要确定IP地址和MAC地址
  IP地址(节点被分配到的地址，可变换)、 MAC地址(网卡所属的固定的地址，基本上不会更改)。


- ARP协议(Address Resolution Protocol)
  是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。


- TCP 提供可靠的字节流服务。TCP位于传输层
  TCP协议采用了三次握手策略，确保数据能到达目标。

  握手的过程中使用了TCP的标志——SYN(synchronize)和ACK(acknowledgement).

  三次握手的过程：
    1. 客户端首先发送一个带SYN标志的数据包给服务端；
    2. 服务端收到后，回传一个带有SYN/ACK标志的数据包来表示已经成功收到数据信息；
    3. 最后，客户端再会传一个带ACK标志的数据包，代表握手结束。


- DNS（Domain Name System）域名解析系统，位于应用层
提供域名到IP地址之间的解析服务。DNS协议提供通过域名查找IP地址，或逆向从IP地址反查域名的服务。


- URI (Uniform Resource Identifier,统一资源标识符) URI用字符串标识某一互联网资源。
- URL (Uniform Resource Locator，统一资源定位符)


# 第二章 简单的HTTP协议

## 2.1 HTTP协议用于客户端和服务器端之间的通信

- 请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端。

- HTTP协议规定，请求从客户端发出，最后服务器端响应该请求并返回。

- 请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成。

- 响应报文基本上是由协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

- HTTP是不保存状态的协议，自身不对请求和响应之间的通信状态进行保存。目的是为了更快地处理大量的事务，确保协议的可伸缩性。使用Cookie技术管理状态。

- HTTP方法

  - 1、GET 获取资源，用来请求访问已被URI识别的资源。
  - 2、POST 传输实体主体
  - 3、PUT 传输文件，自身不带验证机制，安全性存在问题
  - 4、HEAD 获得报文首部，只是不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等。
  - 5、DELETE 删除文件， 自身不带验证机制，安全性存在问题
  - 6、OPTIONS 用来查询针对请求URI指定的资源支持的方法。
  - 7、TRACE 追踪路径，让Web服务器将之前的请求通信环回给客户端的方法。容易受到XSS攻击
  - 8、CONNECT 用隧道协议连接代理
      要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL(Secure Socket Layer, 安全套接层)和TLS(Transport Layer Security, 传输层安全)协议把安全内容加密后经网络隧道传输。

- 持久连接
  HTTP keep-alive 只要任意一端没有明确提出断开连接，则保持TCP连接状态。

  持久连接的好处在于减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。同时提高Web页面的显示速度。

  HTTP/1.1中，所有的连接默认都是持久连接，在HTTP/1.0中并未标准化

- 管线化
  持久连接使得多数请求以管线化方式发送成为可能。可以同时并行发送多个请求

- 使用Cookie的状态管理
  Cookie通过在请求和响应报文中写入Cookie信息来控制客户端的转态。

  Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往该服务器发送请求时，
  客户端会自动在请求报文中加入Cookie值后发送出去。

  服务器端发现客户端发送过来的Cookie后，会去检查究竟是去哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。


# 第三章 HTTP报文内的HTTP信息

## 3.1 HTTP报文
- 用于HTTP协议交互的信息被称为HTTP报文。
- 客户端的HTTP报文叫做请求报文，服务端的叫做响应报文。
- HTTP报文本身是由多行（用CR+LF作换行符）数据构成的字符串文本
- HTTP报文大致可分为报文首部和报文主体两块。两者由最初出现的空行(CR+LF)来划分。
  - CR : 回车符，16进制 0x0d
  - LF: 换行符，16进制 0x0a

- 报文首部： 服务器端或客户端需要处理的请求或响应的内容及属性
- 报文主体： 应被发送的数据

- 请求报文/响应报文  报文首部 + 空行 + 报文主体  

- 请求报文： 请求行 + 请求首部字段 + 通用首部字段 + 实体首部字段 + 其他
- 响应报文： 状态行 + 响应首部字段 + 通用首部字段 + 实体首部字段 + 其他

## 3.2 编码提升传输速率

- 报文 是HTTP通信中的基本单位，由8位组字节流组成，通过HTTP通信传输。
- 实体 作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。
 
- HTTP报文的主体用于传输请求或响应的实体主体。

- HTTP中常用的内容编码有以下几种：
  - gzip(GNU zip)
  - compress (UNIX系统的标准压缩)
  - deflate (zlib)
  - identity (不进行编码)

- 分块传输编码

## 3.3 获取部分内容的范围请求

- 范围请求： Range Request, 执行范围请求时，会用到首部字段Range来指定资源byte范围。

## 3.4 内容协商返回最合适的内容

- 内容协商有三种类型
  1. 服务器驱动协商
  2. 客户端驱动协商
  3. 透明协商


# 第四章 返回结果的HTTP状态码

## 4.1 状态码告知从服务器端返回的请求结果

- 状态码
    
  - 200 表示从客户端发来的请求在服务器端被正常处理了
  - 204 表示服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分。
  - 206 表示客户端进行了范围请求，而服务器成功执行了这部分的请求。响应报文中包含由Content-Range指定范围的实体内容。

  - 301 永久性重定向， 表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI.
  - 302 临时重定向，表示请求的资源已被分配了新的URI,希望用户能使用新的URI访问。
  - 303 表示由于请求对应的资源存在着另一个URI,应使用Get方法定向获取请求的资源。
  - 304 客户端发送附带条件的请求时，服务器允许请求访问资源，但未满足条件的情况。
  - 307 临时重定向，不会从POST变成GET.

  - 400 表示请求报文中存在语法错误。
  - 401 表示发送的请求需要有通过HTTP认证的认证信息。
  - 403 表示请求资源的访问被服务器拒绝了。
  - 404 表示服务器上无法找到请求的资源

  - 500 表示服务器在执行请求时发生了错误
  - 503 表明服务器暂时处于维护状态，无法处理请求。



# 第五章 与HTTP协作的Web服务器

## 5.1 用单台虚拟主机实现多个域名
  - HTTP/1.1规范允许一台HTTP服务器搭建多个Web站点
  - 在互联网上，域名通过DNS服务映射到IP地址之后的目标网站。

## 5.2 代理、网关、隧道
  - 这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应在转发给客户端。

  - 代理： 是一种有转发功能的应用程序，接收由客户端发送的请求并转发给服务器，同事也接收服务器返回的响应并转发给客户端。
    - 代理不改变请求URI,会直接发送给前方持有资源的目标服务器。

    - 理由： 利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的。
    - 缓存代理：代理转发响应时，缓存代理会预先将资源的副本保存在代理服务器上，当代理再次接收到相同的资源请求时，就可以不从源服务器那里获取资源，而将之前缓存的资源作为响应返回。
    - 透明代理：转发请求或响应时，不对报文做任何的加工的代理类型称为透明代理，反之称为非透明代理。

  - 网关： 是转发其他服务器通信数据的服务器。
    - 提高通信的安全性，可以在客户端和网关之间的通信线路上加密以确保连接的安全

  - 隧道： 是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。
  
      - 使用SSL等手段进行加密通信，确保客户端能与服务器进行安全的通信。

## 5.3 保存资源的缓存

  - 缓存是指代理服务器或客户端本地磁盘内保存的资源副本。利用缓存可以减少对服务器的访问，因此也就节省了通信流量和通信时间。


## 第六章 HTTP首部

- HTTP报文首部

  - HTTP请求报文: 由方法、URI、HTTP版本、HTTP首部字段等部分构成
  - HTTP响应报文: 由状态码(数字和原因短语)、HTTP版本、HTTP首部字段等部分构成

- HTTP 首部字段
HTTP首部字段是由首部字段名和字段值构成的，中间用冒号“:”分隔。

- HTTP/1.1 通用首部字段
   
  - Cache-Control: 操作缓存的工作
  - Connection: 控制不再转发给代理的首部字段，管理持久连接， keep-alive
  - Date: 表明创建HTTP报文的日期和时间
  - Transfer-Encoding: 规定了传输保温主体时采用的编码方式
  - Upgrade: 用于检测HTTP协议及其他协议是否可使用更高的版本进行通信


- 请求首部字段
  - Accept
  - Accept-Charset
  - Accept-Encoding
  - Accept-Language
  - Authorization
  - Expect
  - If-Match
  - If-Modified-Since
  - If-None-Match
  - If-Range
  - If-Unmodified-Since
  - Max-Forwards
  - Range
  - Refer
  - User-Agent

- 响应首部字段
  - Accept-Ranges
  - Age
  - ETag

- 实体首部字段
  - Allow
  - Connect-Encoding
  - Connect-Language
  - Connect-Length
  - Connect-Location
  - Connect-Range
  - Connect-Type
  - Expires
  - Last-Modified



# 第七章 确保安全的HTTPS

## 7.1 HTTP的缺点
  - 1. 通信使用明文（不加密），内容可能会被窃听
  - 2. 不验证通信方的身份，因此有可能遭遇伪装
  - 3. 无法证明报文的完整性，所以有可能已遭篡改

- 通信加密
   - HTTP协议中没有加密机制，但可以通过和SSL(Secure Socket Layer)或TLS(Transfer Layer Security)的组合使用，加密HTTP的通信内容。
   - 与SSL组合使用的HTTP被称为HTTPS(HTTP Secure) 或 HTTP over SSL。SSL不仅提供了加密处理，而且还使用了一种被称为证书的手段，可用于确定通信方。


## 7.2 HTTPS = HTTP + 加密 + 认证 + 完整性保护
  - 把添加了加密及认证机制的HTTP称为HTTPS。HTTPS是HTTP通信接口部分用SSL和TLS协议代替而已。HTTPS就是身披SSL协议这层外壳的HTTP。

  - SSL采用公开密钥加密的加密处理方式。
  - 加密和解密同用一个密钥的方式为共享密钥加密，也叫对称密钥加密，不安全。

  - 公开密钥加密采用一对非对称的密钥，一把叫私有密钥，另一把叫公开密钥。

  - 使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，在使用自己的私有密钥进行解密。利用这种方式，不需要发送用来
    解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。

  - HTTPS采用共享密钥加密和公开密钥加密两者并用的混合加密机制。公开密钥加密与对称密钥加密相比，其处理速度要慢，公开密钥加密处理起来比对称密钥加密方式更为
    复杂，效率低。

  - 在交换密钥环节使用公开密钥加密方式，之后建立通信交换报文阶段则使用共享密钥加密方式。

  - 保证公开密钥正确性的证书----CA(数字证书认证机构)

  - HTTPS的安全通行机制
    SSL的慢分两种。一种是指通信慢，另一种是指由于大量消耗CPU及内存等资源，导致处理速度慢。


## 第八章  确认访问用户身份的认证

- HTTP使用的认证方式
  - BASIC认证（基本认证)
  - DIGEST认证（摘要认证）
  - SSL 客户端认证
  - FormBase认证（基于表单认证)

- 使用Cookie来管理Session

- 加盐的方式加密信息



## 第九章 基于HTTP的功能追加协议

  - 消除HTTP瓶颈的SPDY
    目的是解决HTTP的性能瓶颈，缩短Web页面的加载时间
    Ajax 局部刷新
    Comet 服务端推送
    SPDY  在应用层与运输层之间通过新加回话层的形式运作。同时，SPDY规定通信中使用SSL。
    SPDY协议是Google开发的基于TCP的应用层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验。
  - SPDY的好处
      - 多路复用流
      - 赋予请求优先级
      - 压缩HTTP首部
      - 推送功能
      - 服务器提示功能

  - 使用浏览器进行全双工通信的 WebSocket
    WebSocket协议的主要特点
    - 推送功能，支持由服务器向客户端推送数据的推送功能
    - 减少通信量
    - 握手请求 （Upgrade)
    - 握手响应 

  - HTTP/2.0  (目标是改善用户在使用Web时的速度体验)
    提升：
    - HTTP/2.0采用二进制格式而非文本格式
    - HTTP/2.0是完全多路复用的，而非有序并阻塞的(只需一个连接即可实现并行)
    - 使用报头压缩，HTTP/2.0降低了开销
    - HTTP/2.0让服务器可以将响应主动“推送”到客户端缓存中
    - 流量控制


## 第十章 构建Web内容的技术

- HTML
- CSS
- DOM
- CGI(Common Gateway Interface, 通用网关接口)
- Servlet
- XML
- RSS(简易信息聚合)
- JSON



## 第十一章 Web的攻击技术

- SQL注入攻击
- OS命令注入攻击
- 客户端的验证
- XSS（跨站脚本攻击）XSS是攻击者利用预先设置的陷阱触发的被动攻击（窃取客户的Cookie的信息）
- CSRF(跨站点强求伪造)
- 密码破解
  - 通过网络进行密码试错（穷举法、 字典攻击)
  - 已加密密码的破解(通过穷举法、字典攻击 、 彩虹表 、 拿到密钥、 加密算法漏洞)
- 点击劫持
- DOS攻击
- 后门程序
