---
title: 白帽子讲Web安全
permalink: 白帽子讲Web安全
comments: true
date: 2019-06-09 19:27:03
updated: 2019-06-09 19:27:03
tags: Web安全
categories: Web安全
---

白帽子讲Web安全

一、世界观安全

1. 安全的基础是信任。
2. 安全的三要素：CIA
   - 机密性(Confidentiality)   
   - 完整性(Integrity)
   - 可用性(Availability)

3. 机密性
    加密数据
4. 完整性
    数字签名
5. 可用性
   随需而得（DOS,拒绝服务攻击）
   其他：可审计性 、不可抵赖性 


6. 互联网安全的核心问题，是数据安全的问题。

7. 一个优秀的安全方案应该具备以下特点：

    - 能够有效解决问题
    - 用户体验好
    - 高性能
    - 低耦合
    - 易于扩展与升级

8. 白帽子兵法
    - 白名单、黑名单
    - 最小权限原则
    - 纵深防御原则
    - 数据与代码分离原则
    - 不可预测性原则（不可预测性能有效地对坑基于篡改、伪造的攻击。一般要用到加密算法，随机数算法，哈希算法）


第二篇、客户端脚本安全

   二、 浏览器安全

1. 同源策略(基础) 
    浏览器的同源策略， 限定了来自不同源的"document" 或脚本，对当前"document"读取或设置某些属性。

2. 浏览器沙箱
    限制不可信的代码访问隔离区之外的资源。

3. 恶意网址拦截

    基于黑名单

    SSL

4. 高速发展的浏览器安全



    三、跨站脚本攻击(XSS)(Cross Site Script)

    1. XSS攻击
        通常指黑客通过“HTML注入”篡改了网页，插入了恶意的脚本，从而在用户浏览网页时，控制用户浏览器的一种攻击。


   2. XSS攻击的类型

        - 反射型XSS
        - 存储型XSS
        - DOM Based XSS

    3. XSS的防御

        - HttpOnly
        - 输入检查（放在服务器端代码实现， 一般是在客户端和服务器端同时做相同的输入检查）
        - 输出检查
        - 正确地防御XSS
        - 处理富文本（输入检查，标签使用白名单）
        - 防御DOM BASED XSS


    四、跨站点请求伪造（CSRF)(Cross Site Request Forgery)

    1. 攻击者诱使用户访问一个页面，就以该用户身份在第三方站点里执行了一次操作，CSRF攻击的过程，往往是用户不知情的情况下构造了网络请求。

    2. 浏览器的Cookie策略

    3. CSRF的防御

       - 验证码
       - Refer Check
       - Token（需要使用安全的随机数生成器生成Token,要注意Token的保密性和随机性)

    CSRF的本质原因是重要操作的所有参数都是可以被攻击者猜测到的。


    五、点击劫持

    1. 攻击者使用一个透明的、不可见的iframe,覆盖在一个网页上，然后诱使用户在该网页上操作，在用户不知情的情况下，点击透明的iframe页面。

    2. 劫持的几种方式

        - Flash点击劫持

        - 图片覆盖攻击

        - 拖拽劫持与数据窃取

        - 触屏劫持

    3. 防御劫持
        
        - 禁止跨域的iframe

        - X-Frame-Options

    
    六、 HTML5安全

    1. Html5新标签的XSS

    2. iframe的sandbox

    3. 跨域访问的方法（jsonp、iframe)

    4. 跨域访问的限制(Access-Control-Allow-Origin)




  第三篇  服务器端应用安全

   第七章、注入攻击

    1. SQL注入
    2. 盲目注入
    3. 数据库攻击技巧

    4. 正确地防御SQL注入（找到所有的SQL注入漏洞，修补这些漏洞）

      - 防御SQL注入的最佳方式，就是使用预编译语句，绑定变量。

      - 使用安全的存储过程对抗SQL注入。

      - 检测数据类型。

      - 使用安全函数。

    5. 其他注入攻击

      - XML注入
      - 代码注入
    

    第8章、文件上传漏洞

    1. 文件上传漏洞是指用户上传了一个可执行的脚本文件，并通过此脚本文件获得了执行服务器端命令的能力。

    2. 设计安全的文件上传功能

        1. 文件上传的目录设置为不可执行

        2. 判断文件类型

        3. 使用随机数改写文件名和文件路径

        4. 单独设置文件服务器的域名

    

    第九章、认证与会话管理

    1.  认证的目的是为了认出用户是谁，而授权的目的是为了决定用户能够做什么。

    2.  密码必须以不可逆的加密算法，或者是单向散列函数算法，加密后存储在数据库中。

    3. MD5(彩虹表， 加盐)

    4. 多因素认证（动态口令、数字证书、宝令、支付盾）

    5. Session与认证

    - Session劫持

    6. 单点登录（SSO, Single Sign On)

        - OpenID


    第十章、 访问控制

    1. 垂直权限管理

    在配置权限时，应当使用“最小权限原则”，并使用“默认拒绝”的策略，只对有需要的主体单元单独配置“允许”的策略。这在很多时候能够避免发生“越权访问”。

    2. 水平权限管理

    越权访问，用户A访问了用户B的资源

    基于数据的访问控制”用户组“的概念，用户组内的成员才能实现对某些数据的操作。

    3. OAuth
    
    OAuth是一个在不提供用户名和密码的情况下，授权第三方应用访问Web资源的安全协议.OpenID解决的是认证问题，OAuth则更注重授权。

    常见的应用OAuth的场景，一般是某个网站想要获取一个用户在第三方网站钟的某些资源或服务。


    第十一章、加密算法与随机数

    1. 加密算法
    
       分组加密算法： DES AES
       流密码加密算法： RC4 ORYX  SEAL

    2. 密钥管理

        密码系统的安全性应该依赖于密码的复杂性。

        密码管理中最常见的错误，就是将密钥硬编码在代码里。

        对于Web应用来说，常见的做法是将密钥（包括密码）保存在配置文件或数据库中，在使用时由程序读出密钥并加载进内存。

    3、伪随机数

        不要把时间函数当成伪随机数使用。

    
    加密算法的使用和选择上，有以下最佳实践

        1. 不要使用ECB模式；

        2. 不要使用流密码（例如RC4)

        3. 使用HMAC-SHA1代替MD5(甚至是代替SHA1)

        4. 不要使用相同的key做不同的事情；

        5. salts与IV需要随机产生；

        6. 不要自己实现加密算法，尽量使用安全专家已经实现好的库；

        7. 不要依赖系统的保密性。

    常见加密方式选择：

        - 使用CBC模式的AES256用于加密；

        - 使用HMAC-SHA512用于完整性检查；

        - 使用带Salt的SHA-256或SHA-512用于 Hashing.
        

    


  第十二章、 Web框架安全

    1. MVC 框架安全
    2. Web框架与CSRF防御
    3. HTTP Headers管理
    4. Web框架自身问题



第十三章、 应用层拒绝服务攻击

    1、DDOS(分布式拒绝服务， Distributed Denial of Service)

    2、应用层DDOS

    3. 限制请求频率

    4. 解决办法

        - 应用代码要做好性能优化

        - 网络架构上做好优化

        - 实现一些对抗手段，例如限制每个IP地址的请求频率。
    5. 验证码

    6. 防御应用层DDOS


第十四章、  PHP安全


第十五章、 Web Server配置安全

    1. Apache安全

    Apache已root身份或者admin身份运行是一个非常糟糕的决定。

    应该使用专门的用户身份运行Apache,这个用户身份不应该具备Shell,它唯一的作用就是用来运行Web应用。

    2. Nginx安全

    Nginx与Apache最大的区别在于，检查Apach安全时更多的要关注Module的安全，而Nginx则需要注意软件本身的安全，及时升级软件版本。

    3. jBoss远程命令执行

    4. Tomcat 远程命令执行

    5. 注意事情

        在搭建服务器端环境时， 需要注意最小权限原则，应该以独立的低权限身份运行Web进程，同时Web Server的一些参数能够优化性能，有助于缓解DDOS攻击，在实际运用时可以酌情使用。


第四篇  互联网公司安全运营

    第十六章 互联网业务安全

    1. 一个项目的影响因素的优先级

     - 功能是否按原定设计实现；

     - 性能

     - 可用性

     - 是否按原定计划上线

     - 可维护性

     - 安全

    2. 业务逻辑安全

    3. 钓鱼网站

    4. 用户隐私保护


    第十七章、安全开发流程

    1. 开发规范

    2、安全测试

     Web安全扫描器（w3af, skipfish


    第十八章、 安全运营

    1、 安全 —— 三分技术、七分管理

    2. 把安全运营起来

    3. 漏洞修补流程

    4. 安全监控

    5. 入侵检测

    6. 紧急响应流程

     - 邮件报警

     - IM报警

     - 短信报警